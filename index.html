<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>LIFE TRACK DASHBOARD - WELCOME USER</title>
<style>
:root{
  --accent:#2163ff; --accent-2:#7b61ff; --bg:#f6f8fb; --surface:#ffffff;
  --card:#e8eefc; --muted:#6b7280; --text:#0f1724; --app-brightness:1;
  --ui-font: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  --ui-font-size:16px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);font-family:var(--ui-font);font-size:var(--ui-font-size);color:var(--text);-webkit-font-smoothing:antialiased}
.container{max-width:920px;margin:14px auto;padding:16px;filter:brightness(var(--app-brightness))}
.logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800}
.title{font-weight:800;font-size:18px;margin-left:12px;display:inline-block;vertical-align:middle}
.layout{display:grid;grid-template-columns:320px 1fr;gap:16px}
.left{position:sticky;top:12px;height:fit-content}
.card{background:var(--surface);border-radius:12px;padding:12px;border:1px solid var(--card);box-shadow:0 10px 30px rgba(16,24,40,0.06)}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.tile{background:linear-gradient(180deg,#fff,#fbfdff);border-radius:8px;padding:12px;cursor:pointer;border:1px solid #eef4ff;min-height:66px;display:flex;flex-direction:column;justify-content:center}
.tile .label{font-weight:700}
.btn{background:var(--accent);border:0;color:#fff;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:700}
input,select,textarea{width:100%;padding:9px;border-radius:8px;border:1px solid var(--card);background:linear-gradient(180deg,#fff,#fbfdff)}
.screen{display:none;margin-bottom:12px}
.screen.visible{display:block}
.chatbox{height:320px;overflow:auto;border-radius:8px;padding:10px;border:1px solid #eef4ff;background:linear-gradient(180deg,#fff,#fcfdff)}
.small{font-size:13px;color:var(--muted)}
.todo-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;border:1px solid var(--card);margin:8px 0;background:linear-gradient(180deg,#fff,#fbfdff)}
canvas{display:block;width:100%;height:auto;border-radius:8px;background:#fff}
.settings-panel{position:fixed;left:12px;right:12px;top:70px;background:var(--surface);padding:12px;border-radius:12px;border:1px solid var(--card);box-shadow:0 20px 50px rgba(16,24,40,0.12);z-index:999;display:none}
@media (max-width:880px){ .layout{grid-template-columns:1fr} .left{position:static} }
</style>
</head>
<body>
  <div class="container" id="app">
    <div style="display:flex;align-items:center">
      <div class="logo">LT</div>
      <div class="title">LIFE TRACK DASHBOARD - WELCOME USER</div>
    </div>

    <div class="layout" style="margin-top:12px">
      <div class="left">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:700">Quick actions</div>
            <div><button class="btn" id="settingsToggle">App settings</button></div>
          </div>

          <div style="margin-top:12px" class="grid" id="quickGrid" role="list">
            <div class="tile" data-target="chat"><div class="label">üí¨ Chatbot</div></div>
            <div class="tile" data-target="mood"><div class="label">üìä Mood</div></div>
            <div class="tile" data-target="rem"><div class="label">‚úÖ Reminders</div></div>
            <div class="tile" data-target="timer"><div class="label">‚è± Timer</div></div>
            <div class="tile" id="settingsTile"><div class="label">‚öôÔ∏è App settings</div></div>
            <div class="tile" data-target="hydration"><div class="label">üíß Hydration</div></div>
            <div class="tile" data-target="sleep"><div class="label">üåô Sleep</div></div>
            <div class="tile" data-target="charts"><div class="label">üìà Charts</div></div>
          </div>
        </div>

        <div style="height:12px"></div>

        <div class="card">
          <div style="font-weight:700">Totals</div>
          <div style="margin-top:8px">Today calories: <strong id="todayCaloriesLeft">0</strong> kcal</div>
          <div>Water consumed: <strong id="waterConsumedLeft">0</strong> ml</div>
        </div>
      </div>

      <main>
        <section class="card screen visible" id="chat">
          <div id="chatbox" class="chatbox" aria-live="polite"></div>
          <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
            <button class="btn" id="btnJoke">Random joke</button>
            <button class="btn" id="btnTip">Study tip</button>
            <button class="btn" id="btnAllJokes">Show 50 jokes</button>
            <button class="btn" id="btnAllTips">Show 50 tips</button>
          </div>
        </section>

        <section class="card screen" id="mood">
          <div style="margin-top:8px">
            <button class="btn" id="enterMood">Enter mood (1-10)</button>
            <div style="margin-top:8px">Current: <strong id="moodValue">5</strong></div>
            <canvas id="moodCanvas" width="720" height="140" style="margin-top:8px"></canvas>
          </div>
        </section>

        <section class="card screen" id="rem">
          <input id="remText" placeholder="Reminder text" />
          <div style="display:flex;gap:8px;margin-top:8px"><button class="btn" id="addRemBtn">Add</button></div>
          <div id="remList" style="margin-top:8px"></div>
        </section>

        <section class="card screen" id="timer">
          <input id="minutes" type="number" placeholder="Minutes" />
          <label class="small" style="margin-top:8px;display:block">Choose ringtone</label>
          <select id="alarmSelect"></select>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="btn" id="startTimerBtn">Start</button>
            <button class="btn" id="stopTimerBtn" style="background:#ef4444">Stop</button>
          </div>
          <div id="countdown" style="margin-top:12px;font-weight:700"></div>
        </section>

        <section class="card screen" id="hydration">
          <input id="goalWater" type="number" placeholder="Daily goal (ml)" value="2000" />
          <input id="logWater" type="number" placeholder="Log intake (ml)" value="250" />
          <div style="display:flex;gap:8px;margin-top:8px"><button class="btn" id="addWaterBtn">Add intake</button></div>
          <div style="display:flex;justify-content:space-between;margin-top:8px">
            <div>Consumed: <strong id="waterConsumed">0</strong> ml</div>
            <div>Remaining: <strong id="waterRemaining">2000</strong> ml</div>
          </div>
          <input id="waterInterval" type="number" placeholder="Reminder interval (minutes)" value="60" style="margin-top:8px" />
          <div style="display:flex;gap:8px;margin-top:8px"><button class="btn" id="startHydBtn">Start reminders</button><button class="btn" id="stopHydBtn" style="background:#ef4444">Stop</button></div>
          <canvas id="waterCanvas" width="720" height="100" style="margin-top:8px"></canvas>
        </section>

        <section class="card screen" id="sleep">
          <input id="sleepTime" type="time" />
          <input id="wakeTime" type="time" />
          <div style="display:flex;gap:8px;margin-top:8px"><button class="btn" id="logSleepBtn">Log sleep</button></div>
          <div style="margin-top:8px">Last duration: <strong id="lastSleepDuration">0h 0m</strong> ¬∑ 7-day avg: <strong id="avgSleepDuration">0h 0m</strong></div>
          <canvas id="sleepChart" width="720" height="120" style="margin-top:8px"></canvas>
        </section>

        <section class="card screen" id="charts">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:700">Charts</div>
            <div><button class="btn" id="refreshCharts">Refresh</button></div>
         </div>
         <div style="margin-top:12px">
           <canvas id="mealsBar" width="720" height="220"></canvas>
         </div>
         <div style="margin-top:12px">
           <canvas id="sleepBar" width="720" height="140"></canvas>
         </div>
        </section>

      </main>
    </div>
  </div>

  <div class="settings-panel card" id="settingsPanel" aria-hidden="true">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-weight:700">App settings</div>
      <div style="display:flex;gap:8px"><button class="btn" id="saveSettings">Save</button><button class="btn" id="closeSettings" style="background:#ef4444">Close</button></div>
    </div>

    <div style="margin-top:10px;display:grid;gap:8px">
      <select id="fontStyle">
        <option value="system-ui, -apple-system, 'Segoe UI', Roboto, Arial">System</option>
        <option value="'Inter', system-ui, -apple-system, Roboto">Inter</option>
        <option value="'Roboto', system-ui, -apple-system, Arial">Roboto</option>
        <option value="'Helvetica Neue', Arial, sans-serif">Helvetica Neue</option>
        <option value="'Segoe UI', Tahoma, sans-serif">Segoe UI</option>
        <option value="'Georgia', serif">Georgia</option>
        <option value="'Times New Roman', Times, serif">Times</option>
        <option value="'Courier New', monospace">Courier New</option>
        <option value="'Poppins', system-ui, sans-serif">Poppins</option>
        <option value="'Open Sans', system-ui, sans-serif">Open Sans</option>
      </select>

      <label class="small">Font size (px)</label>
      <input id="fontSize" type="range" min="12" max="22" value="16" />

      <label class="small">App brightness</label>
      <input id="appBrightness" type="range" min="0.5" max="1.3" step="0.05" value="1" />
    </div>
  </div>

<script>
/* Utilities */
const $ = id => document.getElementById(id);
function esc(s){ return String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

/* Screen navigation */
document.getElementById('quickGrid').addEventListener('pointerup', e=>{
  const tile = e.target.closest('.tile'); if(!tile) return;
  const target = tile.getAttribute('data-target');
  if(target){
    document.querySelectorAll('.screen.visible').forEach(s=>s.classList.remove('visible'));
    const screen = document.getElementById(target); if(!screen) return;
    screen.classList.add('visible'); screen.scrollIntoView({behavior:'smooth',block:'center'});
  } else if(tile.id === 'settingsTile'){ toggleSettings(true); }
});
$('settingsToggle').addEventListener('pointerup', ()=> toggleSettings(true));
$('closeSettings').addEventListener('pointerup', ()=> toggleSettings(false));
function toggleSettings(force){
  const p = $('settingsPanel');
  p.style.display = (force === true) ? 'block' : (p.style.display === 'block' ? 'none' : 'block');
  p.setAttribute('aria-hidden', p.style.display !== 'block');
}

/* Settings persistence & live apply */
const SETTINGS_KEY = 'lt_settings_final_v2';
function loadSettings(){ try{ return JSON.parse(localStorage.getItem(SETTINGS_KEY)||'null'); }catch(e){ return null; } }
function saveSettings(cfg){ try{ localStorage.setItem(SETTINGS_KEY, JSON.stringify(cfg)); }catch(e){} }
function applySettings(cfg){
  if(!cfg) return;
  if(cfg.fontStyle) document.documentElement.style.setProperty('--ui-font', cfg.fontStyle);
  if(cfg.fontSize) document.documentElement.style.setProperty('--ui-font-size', cfg.fontSize + 'px');
  if(cfg.appBrightness) document.documentElement.style.setProperty('--app-brightness', cfg.appBrightness);
}
(function initSettings(){
  const s = loadSettings();
  if(s){ applySettings(s); $('fontStyle').value = s.fontStyle || getComputedStyle(document.documentElement).getPropertyValue('--ui-font'); $('fontSize').value = s.fontSize || 16; $('appBrightness').value = s.appBrightness || 1; }
  $('fontStyle').addEventListener('change', e=> document.documentElement.style.setProperty('--ui-font', e.target.value));
  $('fontSize').addEventListener('input', e=> document.documentElement.style.setProperty('--ui-font-size', e.target.value + 'px'));
  $('appBrightness').addEventListener('input', e=> document.documentElement.style.setProperty('--app-brightness', e.target.value));
  $('saveSettings').addEventListener('pointerup', ()=>{
    const cfg = { fontStyle: $('fontStyle').value, fontSize: Number($('fontSize').value), appBrightness: Number($('appBrightness').value) };
    saveSettings(cfg); applySettings(cfg); toggleSettings(false);
  });
})();

/* 50 jokes and 50 tips (chatbot) */
const jokes = [
"Why don‚Äôt skeletons fight? They don‚Äôt have the guts!","Why did the math book look sad? It had too many problems.","Why can‚Äôt your nose be 12 inches long? Because then it would be a foot!","Why did the scarecrow win an award? He was outstanding in his field!","What do you call fake spaghetti? An impasta!","Why did the bicycle fall over? It was two-tired!","Why don‚Äôt eggs tell jokes? They‚Äôd crack each other up!","What do you call cheese that isn‚Äôt yours? Nacho cheese!","Why did the golfer bring two pairs of pants? In case he got a hole in one!","Why did the tomato blush? It saw the salad dressing!","Why don‚Äôt scientists trust atoms? Because they make up everything!","Why did the cookie go to the doctor? It was feeling crummy!","Why did the computer go to therapy? It had too many bytes!","Why did the student eat his homework? The teacher said it was a piece of cake!","Why did the cat sit on the computer? To keep an eye on the mouse!","Why did the banana go to the party? Because it was a-peeling!","Why did the chicken join a band? Because it had the drumsticks!","Why did the fish blush? Because it saw the ocean‚Äôs bottom!","Why did the frog take the bus? His car got toad!","Why did the bee get married? Because he found his honey!","Why did the pencil go to the principal‚Äôs office? It had a point to make!","Why did the broom get a promotion? It swept the competition!","Why did the grape stop in the road? It ran out of juice!","Why did the light bulb go to school? To get a little brighter!","Why did the duck get a job? He was tired of winging it!","Why did the elephant bring a suitcase? He was going on a trunk trip!","Why did the calendar apply for a job? It wanted to work full time!","Why did the robot go on vacation? It needed to recharge!","Why did the donut go to therapy? It felt empty inside!","Why did the dog sit in the shade? He didn‚Äôt want to be a hot dog!","Why did the astronaut break up? He needed space!","Why did the fish get bad grades? Because it was below sea level!","Why did the cow go to space? To see the moooon!","Why did the skeleton skip the dance? He had no body to go with!","Why did the kangaroo stop coffee? It made him too jumpy!","Why did the snowman call a cab? He had a meltdown!","Why did the pirate buy an eye patch? He couldn‚Äôt afford an iPhone!","Why did the balloon go near the needle? To pop the question!","Why did the horse go behind the tree? To change his jockeys!","Why did the snail paint an S on his car? So people would say, ‚ÄòLook at that S-car go!‚Äô","Why did the giraffe get bad grades? He had his head in the clouds!","Why did the owl get promoted? He was a real hoot!","Why did the mirror fail the test? It couldn‚Äôt reflect well!","Why did the volcano get a promotion? It was on fire!","Why did the sandwich go to the gym? To get shredded!"
];
const studyTips = [
"Break study sessions into 25-minute chunks with 5-minute breaks.","Teach what you learn ‚Äî explaining helps retention.","Use flashcards for active recall.","Review material within 24 hours.","Create a distraction-free study space.","Set clear goals for each session.","Use mnemonic devices.","Practice past papers under timed conditions.","Summarize notes in your own words.","Use diagrams and mind maps.","Sleep well ‚Äî memory consolidates during rest.","Stay hydrated and eat brain-friendly foods.","Avoid multitasking.","Use spaced repetition.","Study at your peak energy time.","Group study for tough topics.","Use apps like Anki or Quizlet.","Record yourself explaining topics.","Color-code notes.","Reward yourself after tasks.","Spread learning over days, not cramming.","Apply the Feynman technique.","Take movement/stretch breaks.","Turn off notifications.","Use background music if it helps.","Make a weekly checklist.","Start with the hardest subject.","Use real-world examples.","Ask questions to deepen understanding.","Use sticky notes for key facts.","Teach a friend or sibling.","Watch short explainer videos.","Keep a study journal.","Visualize exam success.","Don‚Äôt hesitate to ask for help.","Stay consistent with daily effort.","Use analogies to simplify.","Practice writing essays.","Limit social media.","Use timers to stay on track.","Keep your desk tidy.","Drink water before and during study.","Use site blockers for focus.","Make your own quizzes.","Combine words + visuals (dual coding).","Celebrate small wins.","Stay positive ‚Äî mindset matters.","Track your time to find patterns.","Reflect on what worked and what didn‚Äôt.","Balance study with exercise and relaxation."
];

function appendChat(label, text){
  const box = $('chatbox');
  const el = document.createElement('div');
  el.style.margin='8px 0';
  el.innerHTML = `<div style="font-weight:700">${esc(label)}:</div><div style="margin-top:6px">${esc(text)}</div>`;
  box.appendChild(el);
  box.scrollTop = box.scrollHeight;
}
$('btnJoke').addEventListener('pointerup', ()=> appendChat('Joke', jokes[Math.floor(Math.random()*jokes.length)]));
$('btnTip').addEventListener('pointerup', ()=> appendChat('Tip', studyTips[Math.floor(Math.random()*studyTips.length)]));
$('btnAllJokes').addEventListener('pointerup', ()=> {
  // show all 50 jokes as a compact list
  const box = $('chatbox'); const el = document.createElement('div');
  el.style.margin='8px 0'; el.innerHTML = `<div style="font-weight:700">All jokes:</div><div style="margin-top:6px">${jokes.map((j,i)=>`${i+1}. ${esc(j)}`).join('<br/>')}</div>`;
  box.appendChild(el); box.scrollTop = box.scrollHeight;
});
$('btnAllTips').addEventListener('pointerup', ()=> {
  const box = $('chatbox'); const el = document.createElement('div');
  el.style.margin='8px 0'; el.innerHTML = `<div style="font-weight:700">All study tips:</div><div style="margin-top:6px">${studyTips.map((t,i)=>`${i+1}. ${esc(t)}`).join('<br/>')}</div>`;
  box.appendChild(el); box.scrollTop = box.scrollHeight;
});

/* Reminders */
$('addRemBtn').addEventListener('pointerup', ()=>{
  const t = $('remText').value.trim(); if(!t) return;
  const r = document.createElement('div'); r.className='todo-item';
  r.innerHTML = `<div>${esc(t)}</div><div><button class="btn" data-action="del-rem" style="background:#ef4444">Delete</button></div>`;
  $('remList').prepend(r); $('remText').value='';
});
$('remList').addEventListener('pointerup', e=>{ const b = e.target.closest('button[data-action="del-rem"]'); if(!b) return; b.closest('.todo-item').remove(); });

/* Timer & ringtones (10) */
const ringtones = [
  {id:'r1',label:'Beep',src:'https://actions.google.com/sounds/v1/alarms/beep_short.ogg'},
  {id:'r2',label:'Marimba',src:'https://cdn.pixabay.com/download/audio/2022/03/15/audio_2e6f3e9b4b.mp3'},
  {id:'r3',label:'Bell',src:'https://cdn.pixabay.com/download/audio/2021/09/30/audio_2c9b5f3b3d.mp3'},
  {id:'r4',label:'Digital',src:'https://cdn.pixabay.com/download/audio/2022/12/06/audio_7d2a6f9c6f.mp3'},
  {id:'r5',label:'Chime',src:'https://cdn.pixabay.com/download/audio/2021/08/04/audio_24c7b3d98b.mp3'},
  {id:'r6',label:'Tone A',src:'https://cdn.pixabay.com/download/audio/2022/08/03/audio_7f8f6f1a37.mp3'},
  {id:'r7',label:'Tone B',src:'https://cdn.pixabay.com/download/audio/2022/12/08/audio_2c2f5e4b6a.mp3'},
  {id:'r8',label:'Pluck',src:'https://cdn.pixabay.com/download/audio/2023/01/13/audio_9c8d9e89ab.mp3'},
  {id:'r9',label:'Ping',src:'https://cdn.pixabay.com/download/audio/2021/10/11/audio_3e67b1d9c2.mp3'},
  {id:'r10',label:'Alert',src:'https://cdn.pixabay.com/download/audio/2022/02/20/audio_ab3a610f7f.mp3'}
];
const alarmSelect = $('alarmSelect');
ringtones.forEach(r=>{
  const o = document.createElement('option'); o.value=r.id; o.textContent=r.label; alarmSelect.appendChild(o);
  const a = document.createElement('audio'); a.id = r.id; a.preload='auto'; a.src = r.src; document.body.appendChild(a);
});
let timerInterval = null;
$('startTimerBtn').addEventListener('pointerup', ()=>{
  const mins = Number($('minutes').value||0); if(!mins||mins<=0) return alert('Enter minutes');
  let secs = Math.round(mins*60); const disp = $('countdown'); const choice = alarmSelect.value;
  if(timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    const m = Math.floor(secs/60), s = secs%60;
    disp.textContent = `${m}:${s<10?'0':''}${s}`;
    if(secs-- <= 0){
      clearInterval(timerInterval); timerInterval=null; disp.textContent='Done';
      try{ const a = document.getElementById(choice); if(a){ a.currentTime=0; a.play().catch(()=>{}); } }catch(e){}
    }
  },1000);
});
$('stopTimerBtn').addEventListener('pointerup', ()=>{ if(timerInterval){ clearInterval(timerInterval); timerInterval=null; $('countdown').textContent='Stopped'; } });

/* Hydration (keeps) */
let hydrationTimer = null;
(function initHyd(){ try{ window._lt_water = Number(localStorage.getItem('lt_water')||0); }catch(e){ window._lt_water = 0; } $('waterConsumed').textContent = window._lt_water; $('waterRemaining').textContent = Math.max(Number($('goalWater').value||0)-window._lt_water,0); drawWater(); })();
$('addWaterBtn').addEventListener('pointerup', ()=>{ const v = Number($('logWater').value||0); if(!v) return alert('Enter ml'); window._lt_water = (window._lt_water||0) + v; localStorage.setItem('lt_water', String(window._lt_water)); $('waterConsumed').textContent = window._lt_water; $('waterRemaining').textContent = Math.max(Number($('goalWater').value||0)-window._lt_water,0); drawWater(); updateLeftTotals(); });
$('startHydBtn').addEventListener('pointerup', ()=>{ const mins = Number($('waterInterval').value||0); if(!mins) return alert('Enter minutes'); if(hydrationTimer) clearInterval(hydrationTimer); hydrationTimer = setInterval(()=> alert('Hydration reminder'), mins*60000); alert('Hydration reminders started'); });
$('stopHydBtn').addEventListener('pointerup', ()=>{ if(hydrationTimer){ clearInterval(hydrationTimer); hydrationTimer=null; alert('Hydration reminders stopped'); }});
function drawWater(){ const c = $('waterCanvas'); if(!c) return; const ctx = c.getContext('2d'); ctx.clearRect(0,0,c.width,c.height); const goal = Number($('goalWater').value||0); const consumed = Number(window._lt_water||0); const ratio = goal>0?Math.min(consumed/goal,1):0; const w = (c.width-40)*ratio; ctx.fillStyle='#34d399'; ctx.fillRect(20,c.height/2-12,w,24); ctx.fillStyle='#e6e8f2'; ctx.fillRect(20+w,c.height/2-12,c.width-40-w,24); ctx.fillStyle='#334155'; ctx.font='12px system-ui'; ctx.fillText(`Consumed ${consumed} ml / Goal ${goal} ml`,20,c.height/2-18); }

/* Sleep (keeps) */
let sleepLogs = [];
$('logSleepBtn').addEventListener('pointerup', ()=>{ const s = $('sleepTime').value, w = $('wakeTime').value; if(!s||!w) return alert('Select times'); const [sh,sm] = s.split(':').map(Number), [wh,wm] = w.split(':').map(Number); let start = sh*60+sm, end = wh*60+wm; if(end<=start) end+=24*60; const mins = end-start, hours = mins/60; $('lastSleepDuration').textContent = `${Math.floor(hours)}h ${Math.round((hours%1)*60)}m`; const today = new Date().toISOString().slice(0,10); sleepLogs.push({date:today,hours}); const last7 = sleepLogs.slice(-7); const avg = last7.reduce((a,b)=>a+b.hours,0)/(last7.length||1); $('avgSleepDuration').textContent = `${Math.floor(avg)}h ${Math.round((avg%1)*60)}m`; drawSleep(); });
function drawSleep(){ const c = $('sleepChart'); if(!c) return; const ctx = c.getContext('2d'); ctx.clearRect(0,0,c.width,c.height); const last7 = sleepLogs.slice(-7); if(!last7.length) return; const barW = Math.max(18,(c.width-40)/last7.length - 8); last7.forEach((l,i)=>{ const h = Math.min(12,l.hours)/12*(c.height-30); ctx.fillStyle='#7b61ff'; ctx.fillRect(20 + i*(barW+8), c.height-12-h, barW, h); ctx.fillStyle='#334155'; ctx.font='11px system-ui'; ctx.fillText(l.date.slice(5), 20 + i*(barW+8), c.height-2); }); }

/* Meal logging removed from UI; we still keep a small internal daily list (used by charts) */
function mealsKey(){ return 'lt_meals_' + (new Date()).toISOString().slice(0,10); }
function loadMeals(){ try{ return JSON.parse(localStorage.getItem(mealsKey())||'[]'); }catch(e){ return []; } }
function saveMeals(list){ try{ localStorage.setItem(mealsKey(), JSON.stringify(list)); }catch(e){} }

/* Charts: show last-day meals (if any) and sleep bars */
function drawMealsBar(){
  const meals = loadMeals();
  const c = $('mealsBar'); if(!c) return; const ctx = c.getContext('2d'); ctx.clearRect(0,0,c.width,c.height);
  if(!meals.length){ ctx.fillStyle='#6b7280'; ctx.font='14px system-ui'; ctx.textAlign='center'; ctx.fillText('No meal data (meal tracker removed). If you import meals externally, they will appear here.', c.width/2, c.height/2); return; }
  const list = meals.slice(-12);
  const padding = 40; const w = c.width - padding*2; const h = c.height - padding*2;
  const maxCal = Math.max(...list.map(m=>m.calories||0), 100);
  const barWidth = Math.max(16, (w / list.length) * 0.7);
  list.forEach((m,i)=>{
    const x = padding + i * (w / list.length) + ((w / list.length) - barWidth)/2;
    const barH = (m.calories / maxCal) * h;
    const y = padding + (h - barH);
    ctx.fillStyle = '#ff9f43';
    ctx.fillRect(x, y, barWidth, barH);
    ctx.fillStyle = '#111827'; ctx.font='11px system-ui'; ctx.textAlign='center';
    const label = m.name.length>10 ? m.name.slice(0,10)+'‚Ä¶' : m.name;
    ctx.fillText(label, x + barWidth/2, padding + h + 14);
    ctx.fillText((m.calories||0) + ' kcal', x + barWidth/2, y - 6);
  });
}
function drawSleepBar(){
  const c = $('sleepBar'); if(!c) return; const ctx = c.getContext('2d'); ctx.clearRect(0,0,c.width,c.height);
  const last7 = sleepLogs.slice(-7);
  if(!last7.length){ ctx.fillStyle='#6b7280'; ctx.font='14px system-ui'; ctx.textAlign='center'; ctx.fillText('No sleep data', c.width/2, c.height/2); return; }
  const padding = 28; const w = c.width - padding*2; const h = c.height - padding*2;
  const maxH = Math.max(...last7.map(s=>s.hours||0), 8);
  const barW = Math.max(18, (w / last7.length) * 0.7);
  last7.forEach((l,i)=>{
    const x = padding + i * (w / last7.length) + ((w / last7.length) - barW)/2;
    const barH = (l.hours / maxH) * h;
    const y = padding + (h - barH);
    ctx.fillStyle = '#7b61ff';
    ctx.fillRect(x, y, barW, barH);
    ctx.fillStyle = '#111827'; ctx.font='11px system-ui'; ctx.textAlign='center';
    ctx.fillText(l.date.slice(5), x + barWidth/2 || x + barW/2, padding + h + 14);
    ctx.fillText((l.hours||0).toFixed(1) + 'h', x + barW/2, y - 6);
  });
}

/* Refresh charts button */
$('refreshCharts').addEventListener('pointerup', ()=>{ drawMealsBar(); drawSleepBar(); });

/* Small visuals and boot */
function drawMood(){ const c=$('moodCanvas'); if(!c) return; const ctx=c.getContext('2d'); ctx.clearRect(0,0,c.width,c.height); const v = Number($('moodValue').textContent||5); const w = (v/10)*(c.width-40); ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--accent')||'#2163ff'; ctx.fillRect(20,c.height/2-18,w,36); ctx.fillStyle='#0f1724'; ctx.font='14px system-ui'; ctx.fillText(`Mood: ${v}`,22,c.height/2-24); }
(function boot(){
  try{ window._lt_water = Number(localStorage.getItem('lt_water')||0); }catch(e){ window._lt_water = 0; }
  $('waterConsumed').textContent = window._lt_water;
  $('waterRemaining').textContent = Math.max(Number($('goalWater').value||0)-window._lt_water,0);
  drawWater(); drawMood(); drawMealsBar(); drawSleepBar();
  // keyboard-friendly tiles
  document.querySelectorAll('.tile').forEach(t => t.addEventListener('keydown', e => { if(e.key==='Enter' || e.key===' '){ e.preventDefault(); t.click(); } }));
})();

function updateLeftTotals(){ $('todayCaloriesLeft').textContent = $('todayCalories').textContent || '0'; $('waterConsumedLeft').textContent = $('waterConsumed').textContent || '0'; }

/* Provide a lightweight import endpoint so host (App Inventor) can add meals if desired */
window.LifeTrack = {
  importMeals: function(list){ // list = [{name,calories,portion,ts}]
    const cur = loadMeals(); (list||[]).forEach(i=> cur.push(i)); saveMeals(cur); drawMealsBar();
  },
  getMeals: function(){ return loadMeals(); }
};
</script>
</body>
</html>
